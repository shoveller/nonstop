name: Test Deploy & Notify

on:
  workflow_dispatch:
    inputs:
      deployment_result:
        description: 'Deployment result to simulate'
        required: true
        default: 'success'
        type: choice
        options:
          - success    # ì¡ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œ
          - failure    # ì¡ì´ ì‹¤íŒ¨
          - cancelled  # ì¡ì´ ì·¨ì†Œë¨
          - skipped    # ì¡ì´ ê±´ë„ˆëœ€

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Mock deployment
        run: |
          RESULT="${{ inputs.deployment_result }}"
          echo "Mock deployment starting with result: $RESULT"
          sleep 2
          
          # ì„ íƒëœ ê²°ê³¼ì— ë”°ë¼ ì²˜ë¦¬
          case "$RESULT" in
            success)
              echo "Mock deployment completed successfully!"
              echo "result=success" >> $GITHUB_OUTPUT
              ;;
            failure)
              echo "Mock deployment failed!"
              echo "result=failure" >> $GITHUB_OUTPUT
              exit 1
              ;;
            cancelled)
              echo "Mock deployment was cancelled!"
              echo "result=cancelled" >> $GITHUB_OUTPUT
              exit 1
              ;;
            skipped)
              echo "Mock deployment was skipped!"
              echo "result=skipped" >> $GITHUB_OUTPUT
              ;;
            *)
              echo "Unknown result: $RESULT"
              echo "result=failure" >> $GITHUB_OUTPUT
              exit 1
              ;;
          esac

      - name: Set deployment output
        run: |
          echo "deployment_url=https://test.example.com" >> $GITHUB_OUTPUT

  notify:
    needs: deploy
    if: always()
    uses: ./.github/workflows/notify-telegram.yml
    with:
      deployment_result: ${{ needs.deploy.result }}
      message: ${{ needs.deploy.result == 'success' && 'ğŸš€ í…ŒìŠ¤íŠ¸ ë°°í¬ ì„±ê³µ!' || 'âŒ í…ŒìŠ¤íŠ¸ ë°°í¬ ì‹¤íŒ¨' }}